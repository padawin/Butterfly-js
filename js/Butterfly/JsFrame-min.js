(function(g,q){if(!g.B){throw"B is needed to use JsFrame"}if(!g.B.Ajax){throw"B.Ajax is needed to use JsFrame"}var o=g.B,m="div",u=g.scrollMaxY+g.innerHeight,t=o[k](m,{id:"jsframes"},q.body),y=o[k](m,{"class":"jsframe-background jsframe-closed",style:"height:"+u+"px"},t),i={},x={skipEvent:true,scope:this},k="create",a="firstChild",s="addEvent",f="removeChild",d="insertBefore",v="style",e="children",j="jsframe-closed",l=function(D){t.parentNode||q.body.appendChild(t);this.target=o.$id(D);if(!this.target){throw"Unknown target to create the JsFrame"}this.frame=o[k](m,{"class":"jsframe jsframe-closed"},t);var C="click",F=o[k](m,{"class":"jsframe-content"},this.frame),B=o[k](m,{"class":"jsframe-controls"},this.frame),z=o[k]("span",{text:"fermer","class":"jsframe-close"},B),h,E,A;o[s](z,C,this.close,x);o[s](this.target,C,open,x);if(o.exists(this.target.getAttribute("rel"))&&this.target.getAttribute("rel")!=""){h=this.target.getAttribute("rel");if(i[h]==null){i[h]=[]}i[h][i[h].length]=this;this.albumIndex=i[h].length-1;E=o[k](m,{"class":"jsframe-previous"},F);A=o[k](m,{"class":"jsframe-next"},F);o[s](E,C,c.bind(this),x);o[s](A,C,p.bind(this),x)}},b=function(z){if(z[e][0].offsetHeight>g.innerHeight){z[e][0][v].height=g.innerHeight-100+"px"}z.parentNode[v].width=z[e][0].offsetWidth+"px";z[v].height=z[e][0].offsetHeight+"px";var h;if(g.scrollMaxY){h=g.scrollMaxY+g.innerHeight}else{h=q.documentElement.clientHeight}y[v].height=h+"px"},n=function(){t[v].width="0px";t[v].height="0px";o.addClass(this.frame,j);o.addClass(y,j);if(!q.all&&this.target.getAttribute("rel")!=""){o.removeEvent(g,"keypress",w.bind(this),{scope:this})}},w=function(h){h=h||g.event;var z={37:c,39:p};z[h.keyCode]&&z[h.keyCode].apply(this)},p=function(h){r.apply(this,[1])},c=function(){r.apply(this,[-1])},r=function(z,h,A){A=i[this.target.getAttribute("rel")].length;n.apply(this);i[this.target.getAttribute("rel")][(A+this.albumIndex+z)%A].open()};l.prototype.open=function(){t[v].width=t[v].height="100%";o.removeClass(this.frame,j);o.removeClass(y,j);o[s](y,"click",n,x);var h=o.exists(this.target.getAttribute("alt"))&&this.target.getAttribute("alt")||null,D=this.target.alt,z=this.frame[e][0],E=this.albumIndex!=null?2:0,F,B,A,C=false;if(!o.exists(h)||h==""){throw"No content specified"}else{if(this.frame[e][0][e].length!=E){z[e][0][v].height=null;b(z)}else{F=o[k](m,{"class":"jsframe-loading"});this.frame[e][0][d](F,this.frame[e][0][a]);h=h.split("|");if(h.length==1||h[0]=="image"){A=o[k]("img",{alt:D});o.Ajax.request(h,{},{},"GET",{},{async:false});A.src=h;B=setInterval(function(){if(A.complete){clearInterval(B);if(z[a]){z[f](z[a])}z[d](A,z[a]);b.apply(this,[z])}},100);C=true}else{A=o[k](m);o.Ajax.update(A,h[1],true);if(z[a]){z[f](z[a])}z[d](A,z[a]);z[v].width="100%";z[v].height="auto"}}}if(!q.all&&this.target.getAttribute("rel")!=""){o[s](g,"keypress",w.bind(this),{scope:this})}};o.JsFrame=l})(window,document);
